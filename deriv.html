<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Email Verification</title>
</head>
<body>
    <h1>WebSocket Email Verification Example</h1>
    
    <!-- Input fields for email and number of requests -->
    <label for="email">Enter Email:</label>
    <input type="email" id="email" placeholder="example@gmail.com" required>

    <label for="count">Enter Number of Requests:</label>
    <input type="number" id="count" placeholder="1" min="1" required>

    <button id="sendMessage">Send Email Verification</button>
    
    <div id="response"></div>

    <script>
        document.getElementById('sendMessage').addEventListener('click', function() {
            // Get email and request count from the inputs
            const email = document.getElementById('email').value;
            const count = parseInt(document.getElementById('count').value);

            // Validate email and count input
            if (!email || count <= 0) {
                alert("Please enter a valid email and number of requests.");
                return;
            }

            // Function to create WebSocket connection and send verification email
            function sendVerificationEmail(email) {
                var wsUri = 'wss://green.derivws.com/websockets/v3?app_id=16929&l=fr&brand=deriv';
                var socket = new WebSocket(wsUri);

                socket.onopen = function() {
                    console.log('WebSocket connection opened.');

                    // Payload for verify_email
                    const messageData = {
                        verify_email: email,
                        type: "account_opening",
                        url_parameters: {
                            utm_source: "https://deriv.com/fr/eu/signup",
                            date_first_contact: new Date().toISOString().split('T')[0],
                            signup_device: "desktop"
                        }
                    };
                    socket.send(JSON.stringify(messageData));
                    console.log('Message sent:', messageData);
                };

                socket.onmessage = function(event) {
                    const response = JSON.parse(event.data);
                    document.getElementById('response').innerText = JSON.stringify(response);
                };

                socket.onclose = function() {
                    console.log('WebSocket connection closed.');
                };

                socket.onerror = function(error) {
                    console.error('WebSocket Error:', error);
                };
            }

            // Loop to send the verification email multiple times based on user input
            for (let i = 0; i < count; i++) {
                sendVerificationEmail(email);
            }
        });
    </script>
</body>
</html>

